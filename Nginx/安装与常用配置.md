## å®‰è£…nginx

brew install nginx

## æŸ¥çœ‹nginxé…ç½®

brew info nginx

![image-20210707213627760](../å›¾ç‰‡/image-20210707213627760.png)

## å¯åŠ¨nginx

```bash
æ‰¾åˆ°nginxè„šæœ¬æ‰§è¡Œå‘½ä»¤
ã€whereis nginxã€‘
	/usr/local/bin/nginx
å¯åŠ¨
ã€./nginxã€‘ 
```

## åœæ­¢nginx

```
./nginx -s quit	æ­£å¸¸åœæ­¢
./nginx -s stop	å¼ºåˆ¶åœæ­¢
./nginx -s reload	å¯åŠ¨çŠ¶æ€ä¸‹é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
ps aux|grep nginx	æŸ¥çœ‹nginxè¿›ç¨‹
```

## é…ç½®æ–‡ä»¶

/usr/local/etc/nginx/nginx.conf é…ç½®æ–‡ä»¶

/usr/local/bin/nginx å¯åŠ¨è„šæœ¬

### æ–‡ä»¶å®ä¾‹

```
# mainæ®µé…ç½®ä¿¡æ¯
user  nginx;                        # è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®
worker_processes  auto;             # Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸æ•°ä¸€æ ·
error_log  /var/log/nginx/error.log warn;   # Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•
pid        /var/run/nginx.pid;      # Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®
# eventsæ®µé…ç½®ä¿¡æ¯
events {
    use epoll;     # ä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)
    worker_connections 1024;   # æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°ï¼Œ50000+æœ€å¤§ç†è®ºå€¼ï¼Œä½†æ˜¯ä¸€èˆ¬ç¡¬ä»¶è¾¾ä¸åˆ°
}
# httpæ®µé…ç½®ä¿¡æ¯
# é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®
http { 
    # è®¾ç½®æ—¥å¿—æ¨¡å¼
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /var/log/nginx/access.log  main;   # Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®
    sendfile            on;   # å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼
    tcp_nopush          on;   # å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡
    tcp_nodelay         on;
    keepalive_timeout   65;   # ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’
    types_hash_max_size 2048;
    include             /etc/nginx/mime.types;      # æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨
    default_type        application/octet-stream;   # é»˜è®¤æ–‡ä»¶ç±»å‹
    include /etc/nginx/conf.d/*.conf;   # åŠ è½½å­é…ç½®é¡¹
    # serveræ®µé…ç½®ä¿¡æ¯
    server {
        listen       80;       # é…ç½®ç›‘å¬çš„ç«¯å£
        server_name  localhost;    # é…ç½®çš„åŸŸå
        # locationæ®µé…ç½®ä¿¡æ¯
        location / {
            root   /usr/share/nginx/html;  # ç½‘ç«™æ ¹ç›®å½•
            index  index.html index.htm;   # é»˜è®¤é¦–é¡µæ–‡ä»¶
            deny 172.168.22.11;   # ç¦æ­¢è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall
            allow 172.168.33.44ï¼›# å…è®¸è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall
        }
        error_page 500 502 503 504 /50x.html;  # é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢
        error_page 400 404 error.html;   # åŒä¸Š
    }
    # åå‘ä»£ç†é…ç½®
	 upstream server_list{
       		# è¿™ä¸ªæ˜¯tomcatçš„è®¿é—®è·¯å¾„
      		 server localhost:8081 weight=1;
      		 server localhost:8082 weight=2;
	}
}
```

- #### `main` å…¨å±€é…ç½®ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆï¼›

  - ```
    ##æŒ‡å®šè¿è¡Œ Nginx çš„ woker å­è¿›ç¨‹çš„å±ä¸»å’Œå±ç»„ï¼Œå…¶ä¸­ç»„å¯ä»¥ä¸æŒ‡å®šã€‚
    user nginx lion; # ç”¨æˆ·æ˜¯nginx;ç»„æ˜¯lion
    pid /opt/nginx/logs/nginx.pid # masterä¸»è¿›ç¨‹çš„çš„pidå­˜æ”¾åœ¨nginx.pidçš„æ–‡ä»¶
    
    ##æŒ‡å®š worker å­è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ã€‚
    worker_rlimit_nofile 20480; # å¯ä»¥ç†è§£æˆæ¯ä¸ªworkerå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚
    
    ##æŒ‡å®š worker å­è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åçš„ core æ–‡ä»¶ï¼Œç”¨äºè®°å½•åˆ†æé—®é¢˜ã€‚
    worker_rlimit_core 50M; # å­˜æ”¾å¤§å°é™åˆ¶
    working_directory /opt/nginx/tmp; # å­˜æ”¾ç›®å½•
    
    ##æŒ‡å®š Nginx å¯åŠ¨çš„ worker å­è¿›ç¨‹æ•°é‡ã€‚
    worker_processes 4; # æŒ‡å®šå…·ä½“å­è¿›ç¨‹æ•°é‡
    worker_processes auto; # ä¸å½“å‰cpuç‰©ç†æ ¸å¿ƒæ•°ä¸€è‡´
    
    ##å°†æ¯ä¸ª worker å­è¿›ç¨‹ä¸æˆ‘ä»¬çš„ cpu ç‰©ç†æ ¸å¿ƒç»‘å®šã€‚
    worker_cpu_affinity 0001 0010 0100 1000; # 4ä¸ªç‰©ç†æ ¸å¿ƒï¼Œ4ä¸ªworkerå­è¿›ç¨‹
    å°†æ¯ä¸ª worker å­è¿›ç¨‹ä¸ç‰¹å®š CPU ç‰©ç†æ ¸å¿ƒç»‘å®šï¼Œä¼˜åŠ¿åœ¨äºï¼Œé¿å…åŒä¸€ä¸ª worker å­è¿›ç¨‹åœ¨ä¸åŒçš„ CPU æ ¸å¿ƒä¸Šåˆ‡æ¢ï¼Œç¼“å­˜å¤±æ•ˆï¼Œé™ä½æ€§èƒ½ã€‚ä½†å…¶å¹¶ä¸èƒ½çœŸæ­£çš„é¿å…è¿›ç¨‹åˆ‡æ¢ã€‚(ç®—æ˜¯ç‰©ç†æ‰‹æ³•å®ç°é¿å…çº¿ç¨‹åˆ‡æ¢)
    
    ##æŒ‡å®š worker å­è¿›ç¨‹ä¼˜é›…é€€å‡ºæ—¶çš„è¶…æ—¶æ—¶é—´ã€‚
    worker_shutdown_timeout 5s;
    
    ##worker å­è¿›ç¨‹å†…éƒ¨ä½¿ç”¨çš„è®¡æ—¶å™¨ç²¾åº¦ï¼Œè°ƒæ•´æ—¶é—´é—´éš”è¶Šå¤§ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå°‘ï¼Œæœ‰åˆ©äºæ€§èƒ½æå‡ï¼›åä¹‹ï¼Œç³»ç»Ÿè°ƒç”¨è¶Šå¤šï¼Œæ€§èƒ½ä¸‹é™ã€‚
    timer_resolution 100ms;
    
    ##æŒ‡å®š Nginx çš„è¿è¡Œæ–¹å¼ï¼Œå‰å°è¿˜æ˜¯åå°ï¼Œå‰å°ç”¨äºè°ƒè¯•ï¼Œåå°ç”¨äºç”Ÿäº§ã€‚
    daemon off; # é»˜è®¤æ˜¯onï¼Œåå°è¿è¡Œæ¨¡å¼
    
    ```

- #### `events` é…ç½®å½±å“ `Nginx` æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼›

  - ```
    ##Nginx ä½¿ç”¨ä½•ç§äº‹ä»¶é©±åŠ¨æ¨¡å‹
    use method; # ä¸æ¨èé…ç½®å®ƒï¼Œè®©nginxè‡ªå·±é€‰æ‹©
    method å¯é€‰å€¼ä¸ºï¼šselectã€pollã€kqueueã€epollã€/dev/pollã€eventport
    
    ##worker å­è¿›ç¨‹èƒ½å¤Ÿå¤„ç†çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚
    worker_connections 1024 # æ¯ä¸ªå­è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ä¸º1024
    
    ##æ˜¯å¦æ‰“å¼€è´Ÿè½½å‡è¡¡äº’æ–¥é”ã€‚
    accept_mutex on # é»˜è®¤æ˜¯offå…³é—­çš„ï¼Œè¿™é‡Œæ¨èæ‰“å¼€
    
    ```

    

- #### `http` é…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ï¼›

- #### `server` é…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°(åŒ…æ‹¬èµ„æº)ï¼Œä¸€ä¸ª `http` å—ä¸­å¯ä»¥æœ‰å¤šä¸ª `server` å—ï¼›

  - ##### Server_name æŒ‡å®šè™šæ‹Ÿä¸»æœºåŸŸåï¼Œå½“è®¿é—®çš„åŸŸåè¢«åŒ¹é…æ—¶ï¼Œè¿›å…¥nginxä»£ç†ã€‚

    - ```
      # ç¤ºä¾‹ï¼š
      server_name www.nginx.com;
      
      åŒ¹é…ä¼˜å…ˆçº§ï¼šç²¾ç¡®åŒ¹é… > å·¦ä¾§é€šé…ç¬¦åŒ¹é… > å³ä¾§é€šé…ç¬¦åŒ¹é… > æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
      
      # å·¦åŒ¹é…
      server {
          listen    80;
          server_name    *.nginx-test.com;
          root    /usr/share/nginx/html/nginx-test/left-match/;
          location / {
              index index.html;
          }
      }
      # æ­£åˆ™åŒ¹é…
      server {
          listen    80;
          server_name    ~^.*\.nginx-test\..*$;
          root    /usr/share/nginx/html/nginx-test/reg-match/;
          location / {
              index index.html;
          }
      }
      # å³åŒ¹é…
      server {
          listen    80;
          server_name    www.nginx-test.*;
          root    /usr/share/nginx/html/nginx-test/right-match/;
          location / {
              index index.html;
          }
      }
      # å®Œå…¨åŒ¹é…
      server {
          listen    80;
          server_name    www.nginx-test.com;
          root    /usr/share/nginx/html/nginx-test/all-match/;
          location / {
              index index.html;
          }
      }
      ```

  - ##### rootæŒ‡å®š==é™æ€èµ„æºç›®å½•==ä½ç½®(å³æŒ‡å®šè®¿é—®é™æ€èµ„æºçš„æ–‡ä»¶å¤¹ï¼Œ==[æ³¨æ„] `root` ä¼šå°†å®šä¹‰è·¯å¾„ä¸ `URI` å åŠ ==)

    ```
    ä¾‹å¦‚ï¼š
    location /image {
        root /opt/nginx/static;
    }
    å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.png
    ```

  - ##### alias(å®ƒä¹Ÿæ˜¯æŒ‡å®šé™æ€èµ„æºç›®å½•ä½ç½®ï¼Œå®ƒåªèƒ½å†™åœ¨ `location` ä¸­ã€‚)

    ```
    location /image {
        alias /opt/nginx/static/image/;
    }
    å½“ç”¨æˆ·è®¿é—® www.test.com/image/1.png æ—¶ï¼Œå®é™…åœ¨æœåŠ¡å™¨æ‰¾çš„è·¯å¾„æ˜¯ /opt/nginx/static/image/1.png
    ```

- #### `location` ç”¨äºé…ç½®åŒ¹é…çš„ `uri` ï¼›

  - ```
    é…ç½®è·¯å¾„ã€‚
    
    location [ = | ~ | ~* | ^~ ] uri {
        ...
    }
    åŒ¹é…è§„åˆ™ï¼š
    
    = ç²¾ç¡®åŒ¹é…ï¼›
    ~ æ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™ï¼›
    ~* æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›
    ^~ åŒ¹é…åˆ°å³åœæ­¢æœç´¢ï¼›
    åŒ¹é…ä¼˜å…ˆçº§ï¼š = > ^~ > ~ > ~* > ä¸å¸¦ä»»ä½•å­—ç¬¦ã€‚
    
    server {
      listen    80;
      server_name    www.nginx-test.com;
      # åªæœ‰å½“è®¿é—® www.nginx-test.com/match_all/ æ—¶æ‰ä¼šåŒ¹é…åˆ°/usr/share/nginx/html/match_all/index.html
      location = /match_all/ {
          root    /usr/share/nginx/html
          index index.html
      }
      # å½“è®¿é—® www.nginx-test.com/1.jpg ç­‰è·¯å¾„æ—¶ä¼šå» /usr/share/nginx/images/1.jpg æ‰¾å¯¹åº”çš„èµ„æº
      location ~ \.(jpeg|jpg|png|svg)$ {
          root /usr/share/nginx/images;
      }
      # å½“è®¿é—® www.nginx-test.com/bbs/ æ—¶ä¼šåŒ¹é…ä¸Š /usr/share/nginx/html/bbs/index.html
      location ^~ /bbs/ {
          root /usr/share/nginx/html;
        index index.html index.htm;
      }
    }
    ```

  - ### return

    åœæ­¢å¤„ç†è¯·æ±‚ï¼Œç›´æ¥è¿”å›å“åº”ç æˆ–é‡å®šå‘åˆ°å…¶ä»– `URL` ï¼›æ‰§è¡Œ `return` æŒ‡ä»¤åï¼Œ `location` ä¸­åç»­æŒ‡ä»¤å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚

    ```
    return code [text];
    return code URL;
    return URL;
    ä¾‹å¦‚ï¼š
    location / {
        return 404; # ç›´æ¥è¿”å›çŠ¶æ€ç 
    }
    location / {
        return 404 "pages not found"; # è¿”å›çŠ¶æ€ç  + ä¸€æ®µæ–‡æœ¬
    }
    location / {
        return 302 /bbs ; # è¿”å›çŠ¶æ€ç  + é‡å®šå‘åœ°å€
    }
    location / {
        return https://www.baidu.com ; # è¿”å›é‡å®šå‘åœ°å€
    }
    ```

  - ## rewrite

    æ ¹æ®æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™ï¼Œé‡å†™ `URL` ã€‚

    ```
    è¯­æ³•ï¼šrewrite æ­£åˆ™è¡¨è¾¾å¼ è¦æ›¿æ¢çš„å†…å®¹ [flag];
    ä¸Šä¸‹æ–‡ï¼šserverã€locationã€if
    ç¤ºä¾‹ï¼šrewirte /images/(.*\.jpg)$ /pic/$1; # $1æ˜¯å‰é¢æ‹¬å·(.*\.jpg)çš„åå‘å¼•ç”¨
    
    flag å¯é€‰å€¼çš„å«ä¹‰ï¼š
    
    last é‡å†™åçš„ URL å‘èµ·æ–°è¯·æ±‚ï¼Œå†æ¬¡è¿›å…¥ server æ®µï¼Œé‡è¯• location çš„ä¸­çš„åŒ¹é…ï¼›
    break ç›´æ¥ä½¿ç”¨é‡å†™åçš„ URL ï¼Œä¸å†åŒ¹é…å…¶å®ƒ location ä¸­è¯­å¥ï¼›
    redirect è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼›
    permanent è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼›
    
    
    server{
      listen 80;
      server_name fe.lion.club; # è¦åœ¨æœ¬åœ°hostsæ–‡ä»¶è¿›è¡Œé…ç½®
      root html;
      location /search {
          rewrite ^/(.*) https://www.baidu.com redirect;
      }
      location /images {
          rewrite /images/(.*) /pics/$1;
      }
      location /pics {
          rewrite /pics/(.*) /photos/$1;
      }
      location /photos {
      }
    }
    
    æŒ‰ç…§è¿™ä¸ªé…ç½®æˆ‘ä»¬æ¥åˆ†æï¼š
    
    å½“è®¿é—® fe.lion.club/search æ—¶ï¼Œä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é‡å®šå‘åˆ° https://www.baidu.comã€‚
    å½“è®¿é—® fe.lion.club/images/1.jpg æ—¶ï¼Œç¬¬ä¸€æ­¥é‡å†™ URL ä¸º fe.lion.club/pics/1.jpg ï¼Œæ‰¾åˆ° pics çš„ location ï¼Œç»§ç»­é‡å†™ URL ä¸º fe.lion.club/photos/1.jpg ï¼Œæ‰¾åˆ° /photos çš„ location åï¼Œå» html/photos ç›®å½•ä¸‹å¯»æ‰¾ 1.jpg é™æ€èµ„æºã€‚
    ```

  - ## if æŒ‡ä»¤

    ```
    è¯­æ³•ï¼šif (condition) {...}
    ä¸Šä¸‹æ–‡ï¼šserverã€location
    ç¤ºä¾‹ï¼š
    if($http_user_agent ~ Chrome){
      rewrite /(.*)/browser/$1 break;
    }
    
    condition åˆ¤æ–­æ¡ä»¶ï¼š
    
    $variable ä»…ä¸ºå˜é‡æ—¶ï¼Œå€¼ä¸ºç©ºæˆ–ä»¥0å¼€å¤´å­—ç¬¦ä¸²éƒ½ä¼šè¢«å½“åš false å¤„ç†ï¼›
    = æˆ– != ç›¸ç­‰æˆ–ä¸ç­‰ï¼›
    ~ æ­£åˆ™åŒ¹é…ï¼›
    ! ~ éæ­£åˆ™åŒ¹é…ï¼›
    ~* æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›
    -f æˆ– ! -f æ£€æµ‹æ–‡ä»¶å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›
    -d æˆ– ! -d æ£€æµ‹ç›®å½•å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›
    -e æˆ– ! -e æ£€æµ‹æ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥ç­‰å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼›
    -x æˆ– ! -x æ£€æµ‹æ–‡ä»¶å¯ä»¥æ‰§è¡Œæˆ–ä¸å¯æ‰§è¡Œï¼›
    
    server {
      listen 8080;
      server_name localhost;
      root html;
      location / {
          if ( $uri = "/images/" ){
            rewrite (.*) /pics/ break;
        }
      }
    }
    å½“è®¿é—® localhost:8080/images/ æ—¶ï¼Œä¼šè¿›å…¥ if åˆ¤æ–­é‡Œé¢æ‰§è¡Œ rewrite å‘½ä»¤ã€‚
    ```

  - ## autoindex(è¿™ç§ç›´æ¥åˆ—å‡ºè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶è¿˜æ˜¯æŒºå¸¸è§çš„ï¼‰

    ç”¨æˆ·è¯·æ±‚ä»¥ `/` ç»“å°¾æ—¶ï¼Œåˆ—å‡ºç›®å½•ç»“æ„ï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿæ­å»ºé™æ€èµ„æºä¸‹è½½ç½‘ç«™ã€‚

    ```
    server {
      listen 80;
      server_name fe.lion-test.club;
      location /download/ {
        root /opt/source;
        autoindex on; # æ‰“å¼€ autoindexï¼Œï¼Œå¯é€‰å‚æ•°æœ‰ on | off
        autoindex_exact_size on; # ä¿®æ”¹ä¸ºoffï¼Œä»¥KBã€MBã€GBæ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ä¸ºonï¼Œä»¥bytesæ˜¾ç¤ºå‡ºâ½‚ä»¶çš„ç¡®åˆ‡â¼¤â¼©
        autoindex_format html; # ä»¥htmlçš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¯é€‰å‚æ•°æœ‰ html | json | xml
        autoindex_localtime off; # æ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºâ½‚ä»¶çš„æœåŠ¡å™¨æ—¶é—´ã€‚é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„â½‚ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´
      }
    }
    å½“è®¿é—® fe.lion.com/download/ æ—¶ï¼Œä¼šæŠŠæœåŠ¡å™¨ /opt/source/download/ è·¯å¾„ä¸‹çš„æ–‡ä»¶å±•ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
    
    ```

    ![image-20210709090258641](../å›¾ç‰‡/image-20210709090258641.png)

- #### `upstream` é…ç½®åç«¯æœåŠ¡å™¨å…·ä½“åœ°å€ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼›

  <img src="../å›¾ç‰‡/image-20210708165702758.png" alt="image-20210708165702758" style="zoom: 50%;" />



# é…ç½®å¸¸ç”¨å¸¸é‡

```
server{
    listen 8081;
    server_name var.lion-test.club;
    root /usr/share/nginx/html;
    location / {
        return 200 "
remote_addr: $remote_addr
remote_port: $remote_port
server_addr: $server_addr
server_port: $server_port
server_protocol: $server_protocol
binary_remote_addr: $binary_remote_addr
connection: $connection
uri: $uri
request_uri: $request_uri
scheme: $scheme
request_method: $request_method
request_length: $request_length
args: $args
arg_pid: $arg_pid
is_args: $is_args
query_string: $query_string
host: $host
http_user_agent: $http_user_agent
http_referer: $http_referer
http_via: $http_via
request_time: $request_time
https: $https
request_filename: $request_filename
document_root: $document_root
";
    }
}


å½“æˆ‘ä»¬è®¿é—® http://var.lion-test.club:8081/test?pid=121414&cid=sadasd æ—¶ï¼Œç”±äº Nginx ä¸­å†™äº† return æ–¹æ³•ï¼Œå› æ­¤ chrome æµè§ˆå™¨ä¼šé»˜è®¤ä¸ºæˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢å±•ç¤ºçš„å°±æ˜¯ä¸‹è½½çš„æ–‡ä»¶å†…å®¹ï¼š(å¯ä»¥æ‹¿åˆ°å‡ ä¹æ‰€æœ‰çš„å˜é‡å€¼)

remote_addr: 27.16.220.84
remote_port: 56838
server_addr: 172.17.0.2
server_port: 8081
server_protocol: HTTP/1.1
binary_remote_addr: èŒ‰
connection: 126
uri: /test/
request_uri: /test/?pid=121414&cid=sadasd
scheme: http
request_method: GET
request_length: 518
args: pid=121414&cid=sadasd
arg_pid: 121414
is_args: ?
query_string: pid=121414&cid=sadasd
host: var.lion-test.club
http_user_agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.182 Safari/537.36
http_referer: 
http_via: 
request_time: 0.000
https: 
request_filename: /usr/share/nginx/html/test/
document_root: /usr/share/nginx/html
```

