# 一：网络

##### 主机之间的通信方式：

- 客户-服务器（C/S）：客户是服务的请求方，服务器是服务的提供方。
- 对等（P2P）：不区分客户和服务器。   

##### 三种交换方式：电路交换，报文交换，分组交换

电路交换是以电路连接为目的的交换方式，通信之前要在通信双方之间建立一条被双方独占的物理通道。

**电路交换的三个阶段**：

（1）建立连接	（2）通信	（3）释放连接

优点：由于通信线路为通信双方用户专用，数据直达，所以传输数据的时延非常小。

缺点：电路交换平均连接建立时间对计算机通信来说较长（适用于传输大数据，传输时间大于信道建立时间

##### 分组交换：

分组交换是以分组为单位进行传输和交换的，它是一种存储——转发交换方式，即将到达交换机的分组先送到存储器暂时存储和处理，等到相应的输出电路有空闲时再送出。

优点：（1）分组交换不需要为通信双反预先建立一条专用的通信线路，不存在连接建立时延，用户可随时发送。

缺点：（1）由于数据进入交换节点后要经历存储转发这一过程，从而引起的转发时延（包括接受分组、检验正确性、排队、发送时间等），而且网络的通信量越大，造成的时延就越大，实时性较差。

##### 时延：

总时延 = 排队时延 + 处理时延 + 传输时延 + 传播时延

### 计算机网络体系结构

## 五层协议

- **应用层** ：为特定应用程序提供数据传输服务，例如 HTTP、DNS 等协议。数据单位为报文。(报文)
- **传输层** ：为进程提供通用数据传输服务。TCP 主要提供完整性服务，UDP 主要提供及时性服务(用户数据报)
- **网络层** ：把传输层传递下来的报文段或者用户数据报封装成IP数据报。为主机提供数据传输服务(数据报)(IP,IPV4,IPV6,ICMP:发送主机无法确定数据报是否到达目标主机ICMP报文分为出错报告报文和查询报文两种,IGMP:建立和管理多播组)
- **数据链路层** ：数据链路层把网络层传下来的数据报封装成帧。链路层协议就是为同一链路的主机提供数据传输服务并供错误检测和纠正，以确保数据的可靠传输。（帧）(CSMA/CD,ppp,HDLC)
- **物理层** ：它的主要作用是传输比特流。(比特)

OSI七层协议：应用层，表示层，会话层，传输层，网络层，数据链路层，物理层。

TCP/IP四层协议：网络接口层，网际层，传输层，应用层。

### HTTP:

URI(统一资源标识符) 包含 URL(统一资源定位符) 和 URN(统一资源名称)。

![1566018215417](C:\Users\12714\AppData\Roaming\Typora\typora-user-images\1566018215417.png)

HTTP主要方法：

get：主要用于获取资源。

post：主要用于传输数据.

head:获取报文首部。

put：上传文件。

delete：删除文件，和put相反。

#### HTTP状态码：

1xx:接收的请求正在处理,可以忽略。100(正常)101,协议转换。

2xx:表示成功处理请求。200(OK)。204(no content,成功处理请求，但无返回内容)

3xx:表示重定向，需要进行附加操作以完成请求。localtion+302(临时重定向)，301(永久重定向)

4xx:(客户端错误)请求出错，服务器无法处理请求。403(服务器拒绝请求，访问权限出现问题)404(未找到资源)

5xx:(服务端错误)服务器内部处理请求出错。500(服务器错误，web应用存在的bug或某些临时的错误时)503(服务器不可用:停机维护)

#### HTTP是无状态，短连接协议：

#####  短连接与长连接

短连接：http通信进行TCP握手连接，响应后断开连接。

长连接：建立一次连接，进行多次http通信。

http1.1，基于Connection : Keep-Alive，默认长连接。如关闭：Connection : close。

#### 无状态：

对事物没有记忆能力，所以才有了cookie。之所以设计成无状态，使他能够处理更多的事务。

cookie：用于客户端存储数据，Cookie 渐渐被淘汰。新的浏览器 API 已经允许开发者直接将数据存储到本地，如使用 Web storage API（本地存储和会话存储）或 IndexedDB。

session：客户端存储数据，一般依赖cookie存储的sessionId，如果禁用cookie，使用URL重写解决。

#### HTTPS:

HTTPS 并不是新协议，而是让 HTTP 先和 SSL（Secure Sockets Layer安全套接字层）通信，再由 SSL 和 TCP 通信，也就是说 HTTPS 使用了隧道进行通信。通过使用 SSL，HTTPS 具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）。

SSL介于应用层和TCP层之间。应用层数据不再直接传递给传输层，而是传递给SSL层，SSL层对从应用层收到的数据进行加密，并增加自己的SSL头。

SSL协议可分为三层：

SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。

==主要依靠RSA非对称加密(对称秘钥协商)，对称加密(对称加密加密明文)，MD5哈希散列函数(完整性校验)。==

SSL记录协议（SSL Record Protocol）：记录协议向SSL连接提供两个服务：

（1）保密性：使用握手协议定义的秘密密钥实现

（2）完整性：握手协议定义了MAC，用于保证消息完整性

**SSL警报协议**：用于处理错误，如果是致命错误，则算法立即关闭SSL连接

使用握手协议协商加密和MAC算法以及保密密钥 ，使用记录协议对交换的数据进行加密和签名，使用警报协议定义数据传输过程中，出现问题如何去解决。



#### RSA作用：

1、对称秘钥协商

用普通的秘钥传输，可能被劫持，秘钥就泄露了。可以利用RSA，服务器将公钥给客户端，客户端定制一个对称加密秘钥，使用公钥加密，传输给服务器，服务器用私钥解密。之后就可以利用这个对称秘钥进行加密了。

（但是这种方式无法预防中间人攻击，中间人既做服务端，又做客户端，在中间通信。这里其实最重要的问题是，客户端无法感知和自己通信的是不是真实的服务端【因为不知道这个公钥是不是真实的服务端的】，所以引入了CA证书机构）

2、数字签名

用CA私钥对信息摘要(明文消息加密后)进行加密得到的数字，CA公钥就放在本地证书管理器中，里面有"受信任的根证书颁发机构"列表。客户端会根据这张列表，查看解开数字证书的公钥是否在列表之内。

(所以基本认定CA公钥不可伪造，所有人都能拿的到)

#### CA机构：

潜意识可以直接认为就是为了解决，==保证认可这个公钥是真实的服务器,保证真实性，不会中间人篡改==

所以颁发数字证书，数字证书里包含服务端的公钥，客户端可以用CA公钥解开数字证书，拿到服务端公钥。

![image-20211009085520415](../../../Library/Application Support/typora-user-images/image-20211009085520415.png)

经过上面的了解可以基本归纳了一次通信的过程：A客户端，B服务端

A和B建立HTTPS连接进行通信

A拿到B的数字证书，使用CA公钥解密，拿到B的公钥

使用B的公钥加密A的对称公钥，发送给B，这样B可以用私钥解密，得到A的对称公钥了。(完成对称秘钥的交换)





##### HTTP1.0,1.1,2.0区别：

1.0：无状态、无连接

1.1：持久化连接，keepalive

2.0：压缩头部(没压缩之前，头部数据量很大)，多路复用(一个tcp连接实现多个http请求)，服务器推送(主动推送)

#### 三次握手和四次挥手：

为什么不是两次？

客户端发送的连接请求，并没有消失，而是在某个网络节点长时间滞留了，以至于延迟到连接释放之后才打到服务器。原本这个早已失效的报文段，但是服务器误认为是客服端发送的新的请求，于是就向客户端发送确定的报文段，同意建立连接，若不采用三次握手，新的连接就建立了（莫名其妙就建立的连接）。由于客户端并没有发送连接请求，不会理睬服务器的请求，浪费服务器的资源。  

<img src="../../../Library/Application Support/typora-user-images/image-20220615103209501.png" alt="image-20220615103209501" style="zoom:33%;" />

<img src="../../../Library/Application Support/typora-user-images/image-20220615103238099.png" alt="image-20220615103238099" style="zoom:33%;" />

